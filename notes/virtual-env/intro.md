---
title: 虛擬環境教學系列（一）：虛擬環境是什麼？
author: yueswater
date: 2026/01/31
---

虛擬環境對於許多 Python 初學者而言既熟悉又陌生，甚至不知道為什麼需要使用。但如果充分理解虛擬環境的好處，它對開發專案而言無疑是一大助力。

**虛擬環境 (virtual environment)** 的核心目的是**隔離**套件。[^1]它會在專案內建立一個獨立的資料夾，存放特定版本的套件。之所以要如此大費周章，是因為不同的 Python 專案可能需要不同版本的套件。如果所有專案共用同一個全域環境，升降級某個套件時，就會影響到其他依賴該套件的專案。因此，Python 開發者需要自己管理虛擬環境

## 為什麼我們需要虛擬環境？

誠如上述所言，在 Python 的世界中，套件與套件往往存在著錯綜復雜的依賴關係。想像一下：

- **專案 A** 是一個兩年前開發的舊專案，它依賴某套件的版本 1。
- **專案 B** 是今天想嘗試的最新專案，必須使用某套件的版本 2 才能運作。

如果只有一個全域環境，也就是直接將套件裝在電腦系統中。此時，當專案 B 的套件需要升級時，系統會強制將該套件升級。這時，專案 B 跑起來了，但原本穩定的專案 A 卻會因為套件版本不相容而全面崩潰。

虛擬環境的出現，本質上是為了實現**環境自治**——它讓每個專案都能擁有自己的一套實驗室，無論你在專案 B 裡如何折騰、升級，都不會影響到專案 A 的分毫。

因此，虛擬環境對於開發者而言雖然是一項額外的工作，但是是一種開發保險，能夠將混亂的全域環境切換成整潔的空間，在面對不同時期的專案時，都能游刃有餘。

## 建立與啟用虛擬環境

既然了解虛擬環境的好處，接下來就實際動手操作，建立一個虛擬環境。Python 自從 `3.3` 版後，就內建了名為 `venv 的模組，讓我們不需要額外安裝工具就能輕鬆建立隔離空間。

### 建立虛擬環境

首先，請打開終端機（Terminal 或 PowerShell），切換到你的專案目錄下，輸入以下指令：

```bash
python -m venv .venv
```

:::warning{title="虛擬環境小提醒"}
指令最後的 `.venv` 是虛擬環境的資料夾名稱。加上一個「點」可以讓它在 macOS/Linux 系統中變成**隱藏資料夾**，保持專案目錄的整潔。
:::

執行完畢後，你會發現專案目錄下多了一個名為 `.venv` 的資料夾，這就是虛擬環境專屬的資料夾。

### 啟動與關閉虛擬環境

建立好資料夾並不代表已經在使用它，你必須「啟動」它。啟動後的終端機通常會在路徑前顯示 `(.venv)` 的字樣，提醒你現在正處於隔離狀態。如果是 Windows 使用者，使用以下指令啟動：

```bash
.\.venv\Scripts\Activate.ps1
```

若為 macOS/Linux 使用者，則為

```bash
source .venv/bin/activate
```

:::warning{title="Powershell 的避坑指南"}
如果是 Windows 使用者，執行啟動指令時可能會遇到**禁止執行指令碼**的錯誤，這是因為 PowerShell 預設的安全策略較嚴。解決方法是用系統管理員身分打開 PowerShell 並輸入：`Set-ExecutionPolicy -ExecutionPolicy RemoteSigned` 來解除限制。
:::

如果你想回到全域環境，或者要切換到另一個專案，只需輸入：

```bash
deactivate
```

### 安裝與管理套件

啟動虛擬環境後，任何套件都會被限制在這個環境內。例如，我們要安裝某套件：

```bash
pip install 套件名稱
```

這時候可以放心，在此專案下安裝的套件版本絕對不會去干擾電腦裡的其他專案使用的套件。

### 記錄與還原

當你的專案開發到一個階段，準備分享給別人或是部署到伺服器時，就需要一份套件清單。套件清單是為了自己、協作者或是伺服器知道，這個專案需要什麼套件，而不是把所有 Python 世界的套件全部安裝一遍。匯出清單的方法很簡單，只要輸入以下指令，就會輸出一份存在專案根目錄下的純文字檔：

```bash
pip freeze > requirements.txt
```

如果協作者或是伺服器拿到程式碼，只需要建立並啟動自己的環境後，執行：

```bash
pip install -r requirements.txt
```

系統就會自動把清單上所有特定版本的套件一次裝好。

## 虛擬環境的工作原理

既然我們已經學會如何操作，現在回過頭來看看為什麼這些指令會生效。理解原理後，當遇到環境壞掉或路徑報錯時，就能更有頭緒地解決問題。

很多人以為建立虛擬環境是把整個 Python 在專案目錄中重新安裝一遍，但事實並非如此。虛擬環境非常輕量。它運作的核心只有兩個動作：**複製必要的捷徑**以及**修改環境變數**；又或者是說，虛擬環境是一場優雅的「路徑戲法」。

### 關鍵起點：虛擬環境設定檔

當執行 `python -m venv .venv` 時，Python 做了幾件微小卻關鍵的事：

- 在專案資料夾中建立了一個 `.venv` 目錄。
- 在目錄內放了一個名為 `pyvenv.cfg` 的小檔案。

這個檔案是虛擬環境的大腦，紀錄了你電腦中原本的 Python (Base Python) 安裝路徑。當環境啟動後，Python 會先讀取這個檔案。如果檔案中 `include-system-site-packages` 設為 `false`（預設值），Python 就會故意「**裝作沒看到**」原本全域環境中安裝的那些雜亂套件，從而達成初步的隔離。

### 啟動腳本：決定真正的執行路徑

當我們執行 `source .venv/bin/activate`（或 Windows 下的 `activate.ps1`）時，會暫時修改系統的環境變數 `$PATH`，也就是將虛擬環境中的 `bin`（或 Windows 的 `Scripts`）資料夾路徑，安插到整個路徑清單的最前面。當在終端機輸入 `python` 時，作業系統會從 `$PATH` 的最前端開始尋找執行檔。因為虛擬環境的路徑被插到最前面，系統會優先找到虛擬環境裡的那個 Python 執行檔，而不是原本系統內建的那一個。

### 搜尋路徑的重定向

在 Python 中，有一個變數叫做 `sys.path`，它決定了 Python 去哪裡尋找你用 `import` 引入的套件。當虛擬環境啟動後：

- Python 會自動將搜尋路徑指向虛擬環境內部的 `site-packages` 資料夾。
- 即使你的電腦全域環境裝了某套件的版本 1，只要你的虛擬環境裡裝的是該套件的版本 2，`import 套件` 就只會讀取虛擬環境裡的那份檔案。

這也是為什麼在虛擬環境 A 安裝的套件，切換到虛擬環境 B 時完全看不到的原因——因為它們在物理路徑上根本存放在不同的資料夾。

:::note{title="虛擬環境小提醒"}
理解了這個原理，就知道為什麼直接移動虛擬環境的資料夾時，環境常常會報錯——因為 `pyvenv.cfg` 和啟動腳本裡面寫的通常都是絕對路徑。如果隨意換了位置，這場路徑戲法就演不下去了。這也是為什麼我們通常建議不要把 `.venv` 資料夾上傳到 GitHub，而是分享 `requirements.txt` 讓別人重新建立。
:::


[^1]: Ruby 的 [Bundler](https://bundler.io/) 與 JavaScript 的 [npm](https://www.npmjs.com/) 的套件管理是內建的，但是 Python 的 [pip](https://pip.pypa.io/en/stable/) 則否。